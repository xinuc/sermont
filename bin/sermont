#!/usr/bin/env ruby

require 'rubygems'
require 'sermont'
require 'fileutils'

if ARGV.empty?
  Sermont.new.run
elsif ARGV.include?("--help") || ARGV.include?("-h")
  help = <<-HELP
Usage: sermont [options]
Options

  --setup               : copy example config file to your home directory
  -r,  --raw            : print the report without colors
  -t TIME, --time TIME  : checking every TIME seconds
  -o FILE, --output FILE: write the report to the FILE
  -d, --daemont         : running as a daemon
  -h, --help            : print this help
  HELP
  
  puts(help)
elsif ARGV.include? "--setup"
  FileUtils.cp(File.expand_path(File.dirname(__FILE__) + "/../lib/config/sermont.yaml"), File.expand_path("~/.sermont.yml"))
  FileUtils.mkdir(File.expand_path("~/.sermont"))
  puts "Creating #{File.expand_path("~/.sermont")} directory."
  puts "Copying .sermont.yml to your home directory."
  puts "Please edit this file according to your servers."
else
  raw, time, out, daemon = nil
  raw = ARGV.include?("--raw") || ARGV.include?("-r")
  if ARGV.include?("-t")  || ARGV.include?("--time")
    t_index = ARGV.index("-t") || ARGV.index("--time")
    time = ARGV[t_index + 1]
  end
  if ARGV.include?("-o") || ARGV.include?("--output")
    o_index = ARGV.index("-o") || ARGV.index("--output")
    out = ARGV[o_index + 1]
  end
  daemon = ARGV.include?("--daemon") || ARGV.include?("-d")
  Sermont.new.run(raw, time, out, daemon)
end